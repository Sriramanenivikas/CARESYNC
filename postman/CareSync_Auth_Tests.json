{
  "info": {
    "name": "CareSync Auth Tests",
    "description": "Authentication API tests for CareSync - Updated for Indian Demo Data",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
  },
  "variable": [
    {
      "key": "baseUrl",
      "value": "http://localhost:8080/api"
    }
  ],
  "item": [
    {
      "name": "Authentication",
      "item": [
        {
          "name": "Login - Admin",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status 200', function() { pm.response.to.have.status(200); });",
                  "pm.test('Has token', function() { var d = pm.response.json().data; pm.expect(d.token).to.be.a('string'); pm.expect(d.user.role).to.eql('ADMIN'); });",
                  "pm.collectionVariables.set('adminToken', pm.response.json().data.token);",
                  "pm.collectionVariables.set('refreshToken', pm.response.json().data.refreshToken);"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\"username\":\"test\",\"password\":\"Test@123$\"}"
            },
            "url": "{{baseUrl}}/auth/login"
          }
        },
        {
          "name": "Login - Doctor (Dr. Rajesh Sharma)",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status 200', function() { pm.response.to.have.status(200); });",
                  "pm.test('Has token', function() { var d = pm.response.json().data; pm.expect(d.token).to.be.a('string'); pm.expect(d.user.role).to.eql('DOCTOR'); });",
                  "pm.collectionVariables.set('doctorToken', pm.response.json().data.token);"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\"username\":\"dr.smith\",\"password\":\"Doctor@123\"}"
            },
            "url": "{{baseUrl}}/auth/login"
          }
        },
        {
          "name": "Login - Patient (Rahul Mehta)",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status 200', function() { pm.response.to.have.status(200); });",
                  "pm.test('Has token', function() { var d = pm.response.json().data; pm.expect(d.token).to.be.a('string'); pm.expect(d.user.role).to.eql('PATIENT'); });",
                  "pm.collectionVariables.set('patientToken', pm.response.json().data.token);"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\"username\":\"patient.robert\",\"password\":\"Patient@123\"}"
            },
            "url": "{{baseUrl}}/auth/login"
          }
        },
        {
          "name": "Login - Nurse (Lakshmi Sundaram)",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status 200', function() { pm.response.to.have.status(200); });",
                  "pm.test('Has token', function() { var d = pm.response.json().data; pm.expect(d.token).to.be.a('string'); pm.expect(d.user.role).to.eql('NURSE'); });",
                  "pm.collectionVariables.set('nurseToken', pm.response.json().data.token);"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\"username\":\"nurse.lisa\",\"password\":\"Nurse@123\"}"
            },
            "url": "{{baseUrl}}/auth/login"
          }
        },
        {
          "name": "Login - Receptionist (Mary Fernandes)",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status 200', function() { pm.response.to.have.status(200); });",
                  "pm.test('Has token', function() { var d = pm.response.json().data; pm.expect(d.token).to.be.a('string'); pm.expect(d.user.role).to.eql('RECEPTIONIST'); });",
                  "pm.collectionVariables.set('receptionistToken', pm.response.json().data.token);"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\"username\":\"reception.mary\",\"password\":\"Reception@123\"}"
            },
            "url": "{{baseUrl}}/auth/login"
          }
        },
        {
          "name": "Login - Invalid Password",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status 401 or 500', function() { pm.expect([401, 500]).to.include(pm.response.code); });",
                  "pm.test('Login failed', function() { pm.expect(pm.response.json().success).to.eql(false); });"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\"username\":\"admin\",\"password\":\"wrongpassword\"}"
            },
            "url": "{{baseUrl}}/auth/login"
          }
        },
        {
          "name": "Login - Invalid Username",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status 401 or 500', function() { pm.expect([401, 500]).to.include(pm.response.code); });",
                  "pm.test('Login failed', function() { pm.expect(pm.response.json().success).to.eql(false); });"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\"username\":\"notexist\",\"password\":\"Admin@123\"}"
            },
            "url": "{{baseUrl}}/auth/login"
          }
        },
        {
          "name": "Get Current User",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status 200', function() { pm.response.to.have.status(200); });",
                  "pm.test('Has user info', function() { var d = pm.response.json().data; pm.expect(d.role).to.be.oneOf(['ADMIN', 'TEST']); });"
                ]
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{adminToken}}"
              }
            ],
            "url": "{{baseUrl}}/auth/me"
          }
        },
        {
          "name": "Refresh Token",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status 200', function() { pm.response.to.have.status(200); });",
                  "pm.test('Has new token', function() { var d = pm.response.json().data; pm.expect(d.token).to.be.a('string'); });"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\"refreshToken\":\"{{refreshToken}}\"}"
            },
            "url": "{{baseUrl}}/auth/refresh-token"
          }
        },
        {
          "name": "Logout",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status 200', function() { pm.response.to.have.status(200); });"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{adminToken}}"
              }
            ],
            "url": "{{baseUrl}}/auth/logout"
          }
        },
        {
          "name": "Protected Endpoint - No Token",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status 401', function() { pm.response.to.have.status(401); });",
                  "pm.test('Unauthorized', function() { pm.expect(pm.response.json().success).to.eql(false); });"
                ]
              }
            }
          ],
          "request": {
            "method": "GET",
            "url": "{{baseUrl}}/patients"
          }
        },
        {
          "name": "Protected Endpoint - With Token",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status 200', function() { pm.response.to.have.status(200); });",
                  "pm.test('Has data', function() { pm.expect(pm.response.json().success).to.eql(true); });"
                ]
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{adminToken}}"
              }
            ],
            "url": "{{baseUrl}}/patients?page=0&size=5"
          }
        }
      ]
    }
  ]
}
